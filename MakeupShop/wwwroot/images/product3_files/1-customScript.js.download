!function(){var $,websiteId,chatDocument,privacyPolicyObserver;var frSubsite='3',initialStepId='1';if(_insideCDN.search('us-sandbox2')>-1&&_insideGraph.current.account==='IN-1000767'){frSubsite='142';initialStepId='43';}else if(_insideCDN.search('us-sandbox2')>-1&&_insideGraph.current.account==='IN-1000768'){frSubsite='107';initialStepId='31';}
function observeElement(element,callback,config){try{if(typeof config=="undefined")config={attributes:true,childList:true,subtree:true};const observer=new MutationObserver(function(mutationsList,observer){if(typeof callback==='function'){callback(mutationsList,observer);}});observer.observe(element,config);return observer;}catch(e){}
return null;}
function loadCustomCss(filePath,callback){_insideGraph.loadCSS(filePath,function(){if(callback)callback();insideFrontInterface.windowScale();});}
function loadCustomCssForTheme(filePath,id){chatDocument.find('head').append('<link id="'+id+'" rel="stylesheet" type="text/css" media="all" href="'+filePath+'">');}
function getCustomFilePath(fileName){return _insideCDN+'custom/'+websiteId+'-'+fileName+'?v='+_insideScriptVersion;}
function loadLegacyFiles(){loadCustomCss(getCustomFilePath('sephora-legacy.css'));_insideGraph.loadJS(getCustomFilePath('sephora-legacy.js'));}
_insideGraph.defer(function(){$=_insideGraph.jQuery;websiteId=insideFrontInterface.chat.userid.split(':')[1];setupVhOffset();initPopupAccessibility();insideFrontInterface.bind("assistants",checkAvailableAssistants);checkAvailableAssistants();observeElement(document.getElementById("inside_holder"),checkVisitorNotify,{childList:true});checkVisitorNotify();$('#inside_holder').on('click','.inside_visitorNotify a',function(){if($('#inside_holder').hasClass('sephoraChatNotifTriggered')){$("#inside_liveChatTab").attr('clickedOnPopupEventId',$(this).closest('.inside_visitorNotify').attr('eventid'));}});if(insideFrontInterface.chat.version==1)
loadLegacyFiles();else{loadCustomCss(getCustomFilePath('sephora-custom-theme.css'));_insideGraph.defer(initCustomTheme,function(){return typeof insideChatPane!=="undefined"});}},function(){return typeof insideFrontInterface!="undefined"&&insideFrontInterface.chat&&insideFrontInterface.chat.version;});function checkAvailableAssistants(){if(insideFrontInterface.getAvailableAssistants().length){$('#inside_holder').addClass('chatAvailable');}else{$('#inside_holder').removeClass('chatAvailable');}}
function checkVisitorNotify(){$('.sephoraChatNotifPopup').each(function(){$(this).closest('#inside_holder').addClass('sephoraChatNotifTriggered');});}
_insideGraph.defer(function(){loadCustomCssForTheme(getCustomFilePath('customStyles.css'),"sephora-custom-css");observeElement(document.getElementById("insideChatFrame").contentWindow.document.getElementById("insideChatPaneContent"),checkAddToBasket,{childList:true});var $content=$(document.getElementById("insideChatFrame").contentWindow.document.getElementById("insideChatPaneContent"));$content.find(".inside_product_card").each(function(){processAddToBasketMessage($(this));});$content.on("click","a",function(e){var parents=$(this).parents(".inside_product_card, .inside_chat_product");if(isInsideWebApp()&&parents.length>0){if(parents.hasClass("inside_product_card")&&parents.data("product")&&parents.data("sku")){_insideGraph.doEvent("viewproduct",{"productId":parents.data("product"),"skuId":parents.data("sku")});e.preventDefault();insideChatPane.close();}else if(parents.hasClass("inside_chat_product")&&parents.data("productid")){_insideGraph.doEvent("viewproduct",{"productId":"P"+parents.data("productid")});e.preventDefault();insideChatPane.close();}}else{if(parents.length>0){if(parents.hasClass("inside_product_card")&&parents.data("sku")){trackViewDetails(parents.data("sku"));}}}});},function(){return typeof insideChatPane!="undefined"&&typeof insideChatPane.chatPane!="undefined";});function initPopupAccessibility(){$("#inside_holder").on("keypress",".inside_notify_content",function(e){if(e.key==="Enter"){$(".inside_notify_content:visible").click();}});}
function setupVhOffset(){if($('#inside_holder').attr('device')>1){function throttle(callback,limit){var tick=false;return function(){if(!tick){callback.call();tick=true;setTimeout(function(){tick=false;},limit);}}}
function calculateBottomOffset(){var footerH=0;if($('[data-at="bottom_nav"]').length>0)
footerH+=$('[data-at="bottom_nav"]').outerHeight();if($('[data-comp*="StickyFooter"]').length>0)
footerH+=$('[data-comp*="StickyFooter"]').outerHeight();document.documentElement.style.setProperty('--inside-bottom-offset',footerH+'px');}
calculateBottomOffset()
window.addEventListener("scroll",throttle(calculateBottomOffset,250));window.addEventListener("resize",throttle(calculateBottomOffset,250));}}
function initCustomTheme(){chatDocument=$(document.getElementById('insideChatFrame').contentWindow.document);$('#inside_holder').attr('page-type',window.powerfront&&window.powerfront.pageType);_insideGraph.defer(function(){observeElement(insideChatPane.chatPane,checkChatPane,{attributes:true});checkChatPane();},function(){return typeof insideChatPane.chatPane!="undefined";});}
function isInsideWebApp(){return typeof insideWebApp!="undefined"||(typeof document.getElementById("insideChatFrame").contentWindow.insideWebApp!="undefined"&&document.getElementById("insideChatFrame").contentWindow.insideWebApp==true);}
function checkChatPane(){if($(insideChatPane.chatPane).hasClass('prechat')){$('#inside_holder').addClass('prechat');setTimeout(insideChatPane.windowScale,500);}else $('#inside_holder').removeClass('prechat');}
function checkAddToBasket(e){for(var i=0;i<e.length;i++){for(var node of e[i].addedNodes){var $item=$(node);if($item.find(".inside_product_card").length>0){processAddToBasketMessage($item);}
var $basketLink=$item.find("a.inside-sephora-view-basket");if($basketLink.length){$basketLink.attr("target","_parent");$basketLink.attr("href",location.protocol+"//"+location.hostname+"/basket?utm_source=insidechat");}}}}
function getNotAvailableText(){return _insideGraph.current.subsiteId==frSubsite?"Non disponible":"Not Available";}
function getAddedToBasketText(){return _insideGraph.current.subsiteId==frSubsite?"AjoutÃ© au panier":"Added To Basket";}
function getAddToBasketText(){return _insideGraph.current.subsiteId==frSubsite?"Ajouter au panier":"Add To Basket";}
function trackAddToBasket(skuId){Sephora.analytics.processEvent.process(Sephora.analytics.constants.LINK_TRACKING_EVENT,{data:{actionInfo:Sephora.analytics.constants.ACTION_INFO.ADD_TO_BASKET,linkName:Sephora.analytics.constants.ACTION_INFO.ADD_TO_BASKET,productStrings:skuId?";"+skuId+";;;;eVar26="+skuId:'',eventStrings:Sephora.analytics.constants.Event.SC_ADD,pageName:Sephora.analytics.constants.PAGE_NAMES.SMART_CHAT+":n/a:*",previousPage:Sephora.analytics.constants.PAGE_NAMES.SMART_CHAT+":n/a:*",pageType:'chat',pageDetail:'home chat',world:'n/a'}});}
function trackViewDetails(skuId){Sephora.analytics.processEvent.process(Sephora.analytics.constants.LINK_TRACKING_EVENT,{data:{actionInfo:Sephora.analytics.constants.ACTION_INFO.SEE_DETAILS,linkName:Sephora.analytics.constants.ACTION_INFO.SEE_DETAILS,productStrings:skuId?";"+skuId+";;;;eVar26="+skuId:'',pageName:Sephora.analytics.constants.PAGE_NAMES.SMART_CHAT+":n/a:*",previousPage:Sephora.analytics.constants.PAGE_NAMES.SMART_CHAT+":n/a:*",pageType:'chat',pageDetail:'home chat',world:'n/a'}});}
function processAddToBasketMessage($message){if($message.find(".bubble").length){$message.find(".bubble").addClass("bubble-full-width").css({"width":"100%"});}else{$message.parents(".bubble").addClass("bubble-full-width").css({"width":"100%"});}
var cartApiInProgress=false;$message.find(".inside_product_card_basket").off("click").on("click",function(){var $card=$(this).parents(".inside_product_card");if(isInsideWebApp()){_insideGraph.doEvent("addtobasket",{"productId":$card.data("product"),"skuId":$card.data("sku"),"quantity":1});return;}
if(cartApiInProgress)return;cartApiInProgress=true;var $button=$(this);fetch("/api/shopping-cart/basket/items",{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify({"orderId":"current","skuList":[{"isAcceptTerms":false,"qty":1,"skuId":$card.data("sku")}]})}).then(response=>response.json()).then(data=>{if(typeof(data.errors)=="undefined"){trackAddToBasket($card.data("sku"));$button.text(getAddedToBasketText());setTimeout(function(){$button.text(getAddToBasketText());},3000);Sephora.Util.InflatorComps.services.RefreshBasketService();}else{$button.prop("disabled",true).text(getNotAvailableText()).addClass("disabled");}
cartApiInProgress=false;}).catch(error=>{$button.prop("disabled",true).text(getNotAvailableText()).addClass("disabled");cartApiInProgress=false;});})}
window._insideAddToBasket=window._insideAddToBasket||{};window._insideAddToBasket.onAddToBasketSuccess=onAddToBasketSuccess;function onAddToBasketSuccess(e){var $card=_insideGraph.jQuery("#insideChatFrame").contents().find(".inside_product_card[data-sku='"+e.skuId+"']");$card.find(".inside_product_card_basket").text(getAddedToBasketText());setTimeout(function(){$card.find(".inside_product_card_basket").text(getAddToBasketText());},3000);}
window._insideAddToBasket.onAddToBasketError=onAddToBasketError;function onAddToBasketError(e){var $card=_insideGraph.jQuery("#insideChatFrame").contents().find(".inside_product_card[data-sku='"+e.skuId+"']");$card.find(".inside_product_card_basket").prop("disabled",true).text(getNotAvailableText()).addClass("disabled");}
function addPrivacyPolicy($content){if(_insideGraph.jQuery(document.getElementById("insideChatFrame").contentWindow.document.getElementById("insideChatPaneContent")).find(".inside-privacy-policy").length)return;var $privacy=$("<div>").html("Sephora may record this chat. For more information, see our <a class='inside-sephora-privacy-policy' "+(isInsideWebApp()?"target='_blank' href='"+location.href+"beauty/privacy-policy'":"")+">Privacy Policy</a>.").addClass("inside-privacy-policy");$content.append($privacy);if(!isInsideWebApp()){$content.find('.inside-sephora-privacy-policy').click(function(){Sephora.Util.ThirdParty.openPrivacyModal();return false;});}
if(privacyPolicyObserver)privacyPolicyObserver.disconnect();}
function checkWorkflowStep(){var $content=_insideGraph.jQuery(document.getElementById("insideChatFrame").contentWindow.document.getElementById("insideChatPaneContent"));if(!$content.find(".message").length){setTimeout(checkWorkflowStep,500);}
var $message=$content.find(".message[stepid='"+initialStepId+"']");if($message.length){addPrivacyPolicy($message.find(".content"));}
addPrivacyPolicy($content.find(".message.operator:eq(0) .content"));var $basketLink=$content.find("a.inside-sephora-view-basket");if($basketLink.length){$basketLink.attr("target","_parent");$basketLink.attr("href",location.protocol+"//"+location.hostname+"/basket?utm_source=insidechat");}}
function checkAddedNodes(e){for(var i=0;i<e.length;i++){for(var node of e[i].addedNodes){var $item=_insideGraph.jQuery(node);var $message=$item.find(".message[stepid='"+initialStepId+"']");if($message.length){addPrivacyPolicy($message.find(".content"));}else if($item.attr("stepid")==initialStepId){addPrivacyPolicy($item.find(".content"));}}}
var $content=_insideGraph.jQuery(document.getElementById("insideChatFrame").contentWindow.document.getElementById("insideChatPaneContent"));addPrivacyPolicy($content.find(".message.operator:eq(0) .content"));}
_insideGraph.defer(function(){privacyPolicyObserver=observeElement(document.getElementById("insideChatFrame").contentWindow.document.getElementById("insideChatPaneContent"),checkAddedNodes,{childList:true});checkWorkflowStep();},function(){return typeof insideChatPane!=="undefined"&&typeof insideChatPane.chatPane!=="undefined"});_insideGraph.defer(function(){var device=_insideGraph.jQuery.inside.front.getDevice();_insideGraph.bind("openchatv2",function(){checkWorkflowStep();if(device===1){setTimeout(function(){$('#inside_holder').removeClass('chatPaneOpen');setTimeout(function(){$('#inside_holder').addClass('chatPaneOpen');},100);},400);}});},function(){return typeof _insideGraph!="undefined";});}()